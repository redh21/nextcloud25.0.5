/*! For license information please see photos-src_mixins_FetchAlbumsMixin_js-src_components_Albums_AlbumForm_vue.js.LICENSE.txt */
"use strict";(self.webpackChunkphotos=self.webpackChunkphotos||[]).push([["src_mixins_FetchAlbumsMixin_js-src_components_Albums_AlbumForm_vue"],{12945:(n,t,a)=>{a.d(t,{Z:()=>i});var o=a(20629),l=a(45994),e=a(69363),r=a(99622);const i={name:"FetchAlbumsMixin",data:()=>({errorFetchingAlbums:null,loadingAlbums:!1}),mixins:[e.Z],async beforeMount(){this.fetchAlbums()},computed:{...(0,o.Se)(["albums"])},methods:{...(0,o.nv)(["addAlbums"]),async fetchAlbums(){if(!this.loadingAlbums)try{var n;this.loadingAlbums=!0,this.errorFetchingAlbums=null;const t=await(0,r.CE)("/photos/".concat(null===(n=(0,l.ts)())||void 0===n?void 0:n.uid,"/albums"),this.abortController.signal);this.addAlbums({albums:t})}catch(n){var t;404===(null===(t=n.response)||void 0===t?void 0:t.status)?this.errorFetchingAlbums=404:this.errorFetchingAlbums=n}finally{this.loadingAlbums=!1}}}}},30037:(n,t,a)=>{a.d(t,{Z:()=>i});var o=a(87537),l=a.n(o),e=a(23645),r=a.n(e)()(l());r.push([n.id,".album-form[data-v-cfd4186c]{display:flex;flex-direction:column;height:350px;padding:16px}.album-form .form-title[data-v-cfd4186c]{font-weight:bold}.album-form .form-subtitle[data-v-cfd4186c]{color:var(--color-text-lighter)}.album-form .form-inputs[data-v-cfd4186c]{flex-grow:1;justify-items:flex-end}.album-form .form-inputs input[data-v-cfd4186c]{width:100%}.album-form .form-inputs label[data-v-cfd4186c]{display:flex;margin-top:16px}.album-form .form-inputs label[data-v-cfd4186c] :deep(svg){margin-right:12px}.album-form .form-buttons[data-v-cfd4186c]{display:flex;justify-content:space-between}.album-form .form-buttons .left-buttons[data-v-cfd4186c],.album-form .form-buttons .right-buttons[data-v-cfd4186c]{display:flex}.album-form .form-buttons .right-buttons[data-v-cfd4186c]{justify-content:flex-end}.album-form .form-buttons button[data-v-cfd4186c]{margin-right:16px}.left-buttons[data-v-cfd4186c]{flex-grow:1}","",{version:3,sources:["webpack://./src/components/Albums/AlbumForm.vue"],names:[],mappings:"AAoPA,6BACC,YAAA,CACA,qBAAA,CACA,YAAA,CACA,YAAA,CAEA,yCACC,gBAAA,CAGD,4CACC,+BAAA,CAGD,0CACC,WAAA,CACA,sBAAA,CAEA,gDACC,UAAA,CAGD,gDACC,YAAA,CACA,eAAA,CAEA,2DACC,iBAAA,CAKH,2CACC,YAAA,CACA,6BAAA,CAEA,mHACC,YAAA,CAGD,0DACC,wBAAA,CAGD,kDACC,iBAAA,CAKH,+BACC,WAAA",sourcesContent:['$sizes: ("400": ("count": 3, "marginTop": 66, "marginW": 8), "700": ("count": 4, "marginTop": 66, "marginW": 8), "1024": ("count": 5, "marginTop": 66, "marginW": 44), "1280": ("count": 4, "marginTop": 66, "marginW": 44), "1440": ("count": 5, "marginTop": 88, "marginW": 66), "1600": ("count": 6, "marginTop": 88, "marginW": 66), "2048": ("count": 7, "marginTop": 88, "marginW": 66), "2560": ("count": 8, "marginTop": 88, "marginW": 88), "3440": ("count": 9, "marginTop": 88, "marginW": 88), "max": ("count": 10, "marginTop": 88, "marginW": 88));\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.album-form {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 350px;\n\tpadding: 16px;\n\n\t.form-title {\n\t\tfont-weight: bold;\n\t}\n\n\t.form-subtitle {\n\t\tcolor: var(--color-text-lighter);\n\t}\n\n\t.form-inputs {\n\t\tflex-grow: 1;\n\t\tjustify-items: flex-end;\n\n\t\tinput {\n\t\t\twidth: 100%;\n\t\t}\n\n\t\tlabel {\n\t\t\tdisplay: flex;\n\t\t\tmargin-top: 16px;\n\n\t\t\t:deep(svg) {\n\t\t\t\tmargin-right: 12px;\n\t\t\t}\n\t\t}\n\t}\n\n\t.form-buttons {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\n\t\t.left-buttons, .right-buttons {\n\t\t\tdisplay: flex;\n\t\t}\n\n\t\t.right-buttons {\n\t\t\tjustify-content: flex-end;\n\t\t}\n\n\t\tbutton {\n\t\t\tmargin-right: 16px;\n\t\t}\n\t}\n}\n\n.left-buttons {\n\tflex-grow: 1;\n}\n'],sourceRoot:""}]);const i=r},15802:(n,t,a)=>{a.d(t,{Z:()=>i});var o=a(87537),l=a.n(o),e=a(23645),r=a.n(e)()(l());r.push([n.id,".manage-collaborators[data-v-27acc3ac]{display:flex;flex-direction:column;padding:20px;height:500px}.manage-collaborators__title[data-v-27acc3ac]{font-weight:bold}.manage-collaborators__subtitle[data-v-27acc3ac]{color:var(--color-text-lighter)}.manage-collaborators__public-link-button[data-v-27acc3ac]{margin:4px 0}.manage-collaborators__form[data-v-27acc3ac]{margin-top:4px 0;display:flex;flex-direction:column}.manage-collaborators__form__input[data-v-27acc3ac]{position:relative;display:block}.manage-collaborators__form__input input[data-v-27acc3ac]{width:100%;padding-left:34px}.manage-collaborators__form__input .loading-icon[data-v-27acc3ac]{position:absolute;top:8px;right:8px}.manage-collaborators__form__list[data-v-27acc3ac]{padding:8px;height:500px;overflow:scroll}.manage-collaborators__form__list__result[data-v-27acc3ac]{padding:8px;border-radius:100px;box-sizing:border-box}.manage-collaborators__form__list__result[data-v-27acc3ac],.manage-collaborators__form__list__result *[data-v-27acc3ac]{cursor:pointer !important}.manage-collaborators__form__list__result[data-v-27acc3ac]:hover{background:var(--color-background-dark)}.manage-collaborators__form__list--empty[data-v-27acc3ac]{margin:100px 0}.manage-collaborators__selection[data-v-27acc3ac]{display:flex;flex-direction:column;margin-top:8px;flex-grow:1}.manage-collaborators__selection__item[data-v-27acc3ac]{border-radius:var(--border-radius-pill);padding:0 8px}.manage-collaborators__selection__item[data-v-27acc3ac]:hover{background:var(--color-background-dark)}.manage-collaborators .actions[data-v-27acc3ac]{display:flex;margin-top:8px}.manage-collaborators .actions__public-link[data-v-27acc3ac]{display:flex;align-items:center}.manage-collaborators .actions__public-link button[data-v-27acc3ac]{margin-left:8px}.manage-collaborators .actions__slot[data-v-27acc3ac]{flex-grow:1;display:flex;justify-content:flex-end;align-items:center}","",{version:3,sources:["webpack://./src/components/Albums/CollaboratorsSelectionForm.vue"],names:[],mappings:"AAyaA,uCACC,YAAA,CACA,qBAAA,CACA,YAAA,CACA,YAAA,CAEA,8CACC,gBAAA,CAGD,iDACC,+BAAA,CAGD,2DACC,YAAA,CAGD,6CACC,gBAAA,CACA,YAAA,CACA,qBAAA,CAEA,oDACC,iBAAA,CACA,aAAA,CAEA,0DACC,UAAA,CACA,iBAAA,CAGD,kEACC,iBAAA,CACA,OAAA,CACA,SAAA,CAIF,mDACC,WAAA,CACA,YAAA,CACA,eAAA,CACA,2DACC,WAAA,CACA,mBAAA,CACA,qBAAA,CAEA,wHACC,yBAAA,CAGD,iEACC,uCAAA,CAIF,0DACC,cAAA,CAKH,kDACC,YAAA,CACA,qBAAA,CACA,cAAA,CACA,WAAA,CAEA,wDACC,uCAAA,CACA,aAAA,CAEA,8DACC,uCAAA,CAKH,gDACC,YAAA,CACA,cAAA,CAEA,6DACC,YAAA,CACA,kBAAA,CAEA,oEACC,eAAA,CAIF,sDACC,WAAA,CACA,YAAA,CACA,wBAAA,CACA,kBAAA",sourcesContent:['$sizes: ("400": ("count": 3, "marginTop": 66, "marginW": 8), "700": ("count": 4, "marginTop": 66, "marginW": 8), "1024": ("count": 5, "marginTop": 66, "marginW": 44), "1280": ("count": 4, "marginTop": 66, "marginW": 44), "1440": ("count": 5, "marginTop": 88, "marginW": 66), "1600": ("count": 6, "marginTop": 88, "marginW": 66), "2048": ("count": 7, "marginTop": 88, "marginW": 66), "2560": ("count": 8, "marginTop": 88, "marginW": 88), "3440": ("count": 9, "marginTop": 88, "marginW": 88), "max": ("count": 10, "marginTop": 88, "marginW": 88));\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.manage-collaborators {\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding: 20px;\n\theight: 500px;\n\n\t&__title {\n\t\tfont-weight: bold;\n\t}\n\n\t&__subtitle {\n\t\tcolor: var(--color-text-lighter);\n\t}\n\n\t&__public-link-button {\n\t\tmargin: 4px 0;\n\t}\n\n\t&__form {\n\t\tmargin-top: 4px 0;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\n\t\t&__input {\n\t\t\tposition: relative;\n\t\t\tdisplay: block;\n\n\t\t\tinput {\n\t\t\t\twidth: 100%;\n\t\t\t\tpadding-left: 34px;\n\t\t\t}\n\n\t\t\t.loading-icon {\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: calc(36px / 2 - 20px / 2);\n\t\t\t\tright: 8px;\n\t\t\t}\n\t\t}\n\n\t\t&__list {\n\t\t\tpadding: 8px;\n\t\t\theight: 500px;\n\t\t\toverflow: scroll;\n\t\t\t&__result {\n\t\t\t\tpadding: 8px;\n\t\t\t\tborder-radius: 100px;\n\t\t\t\tbox-sizing: border-box;\n\n\t\t\t\t&, & * {\n\t\t\t\t\tcursor: pointer !important;\n\t\t\t\t}\n\n\t\t\t\t&:hover {\n\t\t\t\t\tbackground: var(--color-background-dark);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t&--empty {\n\t\t\t\tmargin: 100px 0;\n\t\t\t}\n\t\t}\n\t}\n\n\t&__selection {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tmargin-top: 8px;\n\t\tflex-grow: 1;\n\n\t\t&__item {\n\t\t\tborder-radius: var(--border-radius-pill);\n\t\t\tpadding:  0 8px;\n\n\t\t\t&:hover {\n\t\t\t\tbackground: var(--color-background-dark);\n\t\t\t}\n\t\t}\n\t}\n\n\t.actions {\n\t\tdisplay: flex;\n\t\tmargin-top: 8px;\n\n\t\t&__public-link {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\n\t\t\tbutton {\n\t\t\t\tmargin-left: 8px;\n\t\t\t}\n\t\t}\n\n\t\t&__slot {\n\t\t\tflex-grow: 1;\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: flex-end;\n\t\t\talign-items: center;\n\t\t}\n\t}\n}\n'],sourceRoot:""}]);const i=r},96922:(n,t,a)=>{a.d(t,{Z:()=>w});var o=a(20629),l=a(93050),e=a(94878),r=a(75400),i=a(45994),s=a(33476),c=a(80351),u=a.n(c),b=a(1856);const m={name:"AlbumForm",components:{MapMarker:l.Z,AccountMultiplePlus:e.Z,Send:r.Z,NcButton:s.NcButton,NcLoadingIcon:s.NcLoadingIcon,NcTextField:s.NcTextField,CollaboratorsSelectionForm:b.Z},props:{album:{type:Object,default:null},displayBackButton:{type:Boolean,default:!1}},data:()=>({showCollaboratorView:!1,albumName:"",albumLocation:"",loading:!1}),computed:{editMode(){return null!==this.album},sharingEnabled:()=>void 0!==OC.Share},mounted(){this.editMode&&(this.albumName=this.album.basename,this.albumLocation=this.album.location),this.$nextTick((()=>{this.$refs.nameInput.$el.getElementsByTagName("input")[0].focus()}))},methods:{...(0,o.nv)(["createAlbum","renameAlbum","updateAlbum"]),submit(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];""===this.albumName||this.loading||(this.editMode?this.handleUpdateAlbum():this.handleCreateAlbum(n))},async handleCreateAlbum(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];try{this.loading=!0;let t=await this.createAlbum({album:{basename:this.albumName,filename:"/photos/".concat((0,i.ts)().uid,"/albums/").concat(this.albumName),nbItems:0,location:this.albumLocation,lastPhoto:-1,date:u()().format("MMMM YYYY"),collaborators:n}});""===this.albumLocation&&0===n.length||(t=await this.updateAlbum({albumName:this.albumName,properties:{location:this.albumLocation,collaborators:n}})),this.$emit("done",{album:t})}finally{this.loading=!1}},async handleUpdateAlbum(){try{this.loading=!0;let n={...this.album};this.album.basename!==this.albumName&&(n=await this.renameAlbum({currentAlbumName:this.album.basename,newAlbumName:this.albumName})),this.album.location!==this.albumLocation&&(n.location=await this.updateAlbum({albumName:this.albumName,properties:{location:this.albumLocation}})),this.$emit("done",{album:n})}finally{this.loading=!1}},back(){this.$emit("back")}}};var d=a(93379),A=a.n(d),p=a(7795),h=a.n(p),C=a(90569),g=a.n(C),_=a(3565),f=a.n(_),v=a(19216),y=a.n(v),x=a(44589),k=a.n(x),N=a(30037),E={};E.styleTagTransform=k(),E.setAttributes=f(),E.insert=g().bind(null,"head"),E.domAPI=h(),E.insertStyleElement=y();A()(N.Z,E);N.Z&&N.Z.locals&&N.Z.locals;const w=(0,a(51900).Z)(m,(function(){var n=this,t=n.$createElement,a=n._self._c||t;return n.showCollaboratorView?a("CollaboratorsSelectionForm",{attrs:{"album-name":n.albumName,"allow-public-link":!1},scopedSlots:n._u([{key:"default",fn:function(t){var o=t.collaborators;return[a("span",{staticClass:"left-buttons"},[a("NcButton",{attrs:{"aria-label":n.t("photos","Back to the new album form."),type:"tertiary"},on:{click:function(t){n.showCollaboratorView=!1}}},[n._v("\n\t\t\t\t"+n._s(n.t("photos","Back"))+"\n\t\t\t")])],1),n._v(" "),a("span",{staticClass:"right-buttons"},[a("NcButton",{attrs:{"aria-label":n.editMode?n.t("photos","Save."):n.t("photos","Create the album."),type:"primary",disabled:""===n.albumName.trim()||n.loading},on:{click:function(t){return n.submit(o)}},scopedSlots:n._u([{key:"icon",fn:function(){return[n.loading?a("NcLoadingIcon"):a("Send")]},proxy:!0}],null,!0)},[n._v("\n\t\t\t\t"+n._s(n.editMode?n.t("photos","Save"):n.t("photos","Create album"))+"\n\t\t\t")])],1)]}}])}):a("form",{staticClass:"album-form",on:{submit:function(t){return t.preventDefault(),n.submit.apply(null,arguments)}}},[a("div",{staticClass:"form-inputs"},[a("NcTextField",{ref:"nameInput",attrs:{value:n.albumName,type:"text",name:"name",required:!0,autofocus:"true",placeholder:n.t("photos","Name of the album")},on:{"update:value":function(t){n.albumName=t}}}),n._v(" "),a("label",[a("MapMarker"),a("NcTextField",{attrs:{value:n.albumLocation,name:"location",type:"text",placeholder:n.t("photos","Location of the album")},on:{"update:value":function(t){n.albumLocation=t}}})],1)],1),n._v(" "),a("div",{staticClass:"form-buttons"},[a("span",{staticClass:"left-buttons"},[n.displayBackButton?a("NcButton",{attrs:{"aria-label":n.t("photos","Go back to the previous view."),type:"tertiary"},on:{click:n.back}},[n._v("\n\t\t\t\t"+n._s(n.t("photos","Back"))+"\n\t\t\t")]):n._e()],1),n._v(" "),a("span",{staticClass:"right-buttons"},[n.sharingEnabled&&!n.editMode?a("NcButton",{attrs:{"aria-label":n.t("photos","Go to the add collaborators view."),type:"secondary",disabled:""===n.albumName.trim()||n.loading},on:{click:function(t){n.showCollaboratorView=!0}},scopedSlots:n._u([{key:"icon",fn:function(){return[a("AccountMultiplePlus")]},proxy:!0}],null,!1,1531126728)},[n._v("\n\t\t\t\t"+n._s(n.t("photos","Add collaborators"))+"\n\t\t\t")]):n._e(),n._v(" "),a("NcButton",{attrs:{"aria-label":n.editMode?n.t("photos","Save."):n.t("photos","Create the album."),type:"primary",disabled:""===n.albumName||n.loading},on:{click:function(t){return n.submit()}},scopedSlots:n._u([{key:"icon",fn:function(){return[n.loading?a("NcLoadingIcon"):a("Send")]},proxy:!0}],null,!1,3914512768)},[n._v("\n\t\t\t\t"+n._s(n.editMode?n.t("photos","Save"):n.t("photos","Create album"))+"\n\t\t\t")])],1)])])}),[],!1,null,"cfd4186c",null).exports},1856:(n,a,o)=>{o.d(a,{Z:()=>F});var l=o(20629),e=o(38530),r=o(31894),i=o(14625),s=o(47987),c=o(86472),u=o(55683),b=o(26937),m=o(82880),d=o(45994),A=o(79753),p=o(33476),h=o(41922),C=o(59537),g=o(69363),_=o(99622);const f={name:"CollaboratorsSelectionForm",components:{Magnify:e.Z,Close:r.default,AccountGroup:c.Z,ContentCopy:s.Z,Check:i.default,Earth:u.Z,NcLoadingIcon:p.NcLoadingIcon,NcButton:p.NcButton,NcListItemIcon:p.NcListItemIcon,NcTextField:p.NcTextField,NcPopover:p.NcPopover,NcEmptyContent:p.NcEmptyContent},mixins:[g.Z],props:{albumName:{type:String,required:!0},collaborators:{type:Array,default:()=>[]},allowPublicLink:{type:Boolean,default:!0}},data:()=>({searchText:"",availableCollaborators:{},selectedCollaboratorsKeys:[],currentSearchResults:[],loadingAlbum:!1,errorFetchingAlbum:null,loadingCollaborators:!1,randomId:Math.random().toString().substring(2,10),publicLinkCopied:!1,config:{minSearchStringLength:parseInt(OC.config["sharing.minSearchStringLength"],10)||0}}),computed:{searchResults(){return this.currentSearchResults.filter((n=>{let{id:t}=n;return t!==(0,d.ts)().uid})).map((n=>{let{type:t,id:a}=n;return"".concat(t,":").concat(a)})).filter((n=>!this.selectedCollaboratorsKeys.includes(n)))},listableSelectedCollaboratorsKeys(){return this.selectedCollaboratorsKeys.filter((n=>this.availableCollaborators[n].type!==h.D.SHARE_TYPE_LINK))},selectedCollaborators(){return this.selectedCollaboratorsKeys.map((n=>this.availableCollaborators[n]))},isPublicLinkSelected(){return this.selectedCollaboratorsKeys.includes("".concat(h.D.SHARE_TYPE_LINK))},publicLink(){return this.availableCollaborators[h.D.SHARE_TYPE_LINK]}},watch:{collaborators(n){this.populateCollaborators(n)}},mounted(){this.searchCollaborators(),this.populateCollaborators(this.collaborators)},methods:{...(0,l.nv)(["updateAlbum","addAlbums"]),async searchCollaborators(){try{if(this.searchText.length<this.config.minSearchStringLength)return;this.loadingCollaborators=!0;const n=await b.Z.get((0,A.generateOcsUrl)("core/autocomplete/get"),{params:{search:this.searchText,itemType:"share-recipients",shareTypes:[h.D.SHARE_TYPE_USER,h.D.SHARE_TYPE_GROUP]}});this.currentSearchResults=n.data.ocs.data.map((n=>{switch(n.source){case"users":return{id:n.id,label:n.label,type:h.D.SHARE_TYPE_USER};case"groups":return{id:n.id,label:n.label,type:h.D.SHARE_TYPE_GROUP};default:throw new Error("Invalid collaborator source ".concat(n.source))}})),this.availableCollaborators={...this.availableCollaborators,...this.currentSearchResults.reduce(this.indexCollaborators,{})}}catch(n){this.errorFetchingCollaborators=n,C.Z.error(t("photos","Failed to fetch collaborators list."),n),(0,m.showError)(t("photos","Failed to fetch collaborators list."))}finally{this.loadingCollaborators=!1}},populateCollaborators(n){const a=n.reduce(this.indexCollaborators,{});this.selectedCollaboratorsKeys=Object.keys(a),this.availableCollaborators={3:{id:"",label:t("photos","Public link"),type:h.D.SHARE_TYPE_LINK},...this.availableCollaborators,...a}},indexCollaborators:(n,t)=>({...n,["".concat(t.type).concat(t.type===h.D.SHARE_TYPE_LINK?"":":").concat(t.type===h.D.SHARE_TYPE_LINK?"":t.id)]:t}),async createPublicLinkForAlbum(){this.selectEntity("".concat(h.D.SHARE_TYPE_LINK)),await this.updateAlbumCollaborators();try{this.loadingAlbum=!0,this.errorFetchingAlbum=null;const n=await(0,_.Lz)("/photos/".concat((0,d.ts)().uid,"/albums/").concat(this.albumName),{signal:this.abortController.signal});this.addAlbums({albums:[n]})}catch(t){var n;404===(null===(n=t.response)||void 0===n?void 0:n.status)?this.errorFetchingAlbum=404:this.errorFetchingAlbum=t,C.Z.error("[PublicAlbumContent] Error fetching album",{error:t}),(0,m.showError)(this.t("photos","Failed to fetch album."))}finally{this.loadingAlbum=!1}},async deletePublicLink(){this.unselectEntity("".concat(h.D.SHARE_TYPE_LINK)),this.availableCollaborators[3]={id:"",label:t("photos","Public link"),type:h.D.SHARE_TYPE_LINK},this.publicLinkCopied=!1,await this.updateAlbumCollaborators()},async updateAlbumCollaborators(){try{await this.updateAlbum({albumName:this.albumName,properties:{collaborators:this.selectedCollaborators}})}catch(n){C.Z.error("[PublicAlbumContent] Error updating album",{error:n}),(0,m.showError)(this.t("photos","Failed to update album."))}finally{this.loadingAlbum=!1}},async copyPublicLink(){await navigator.clipboard.writeText("".concat(window.location.protocol,"//").concat(window.location.host).concat((0,A.generateUrl)("apps/photos/public/".concat(this.publicLink.id)))),this.publicLinkCopied=!0,setTimeout((()=>{this.publicLinkCopied=!1}),1e4)},selectEntity(n){this.selectedCollaboratorsKeys.includes(n)||(this.$refs.popover.$refs.popover.hide(),this.selectedCollaboratorsKeys.push(n))},unselectEntity(n){const t=this.selectedCollaboratorsKeys.indexOf(n);-1!==t&&this.selectedCollaboratorsKeys.splice(t,1)}}};var v=o(93379),y=o.n(v),x=o(7795),k=o.n(x),N=o(90569),E=o.n(N),w=o(3565),L=o.n(w),T=o(19216),S=o.n(T),B=o(44589),D=o.n(B),I=o(15802),P={};P.styleTagTransform=D(),P.setAttributes=L(),P.insert=E().bind(null,"head"),P.domAPI=k(),P.insertStyleElement=S();y()(I.Z,P);I.Z&&I.Z.locals&&I.Z.locals;const F=(0,o(51900).Z)(f,(function(){var n=this,t=n.$createElement,a=n._self._c||t;return a("div",{staticClass:"manage-collaborators"},[a("h2",{staticClass:"manage-collaborators__title"},[n._v("\n\t\t"+n._s(n.t("photos","Add collaborators"))+"\n\t")]),n._v(" "),a("div",{staticClass:"manage-collaborators__subtitle"},[n._v("\n\t\t"+n._s(n.t("photos","Add people or groups who can edit your album"))+"\n\t")]),n._v(" "),a("form",{staticClass:"manage-collaborators__form",on:{submit:function(n){n.preventDefault()}}},[a("NcPopover",{ref:"popover",attrs:{"auto-size":!0,distance:0}},[a("label",{staticClass:"manage-collaborators__form__input",attrs:{slot:"trigger"},slot:"trigger"},[a("NcTextField",{attrs:{value:n.searchText,autocomplete:"off",type:"search",name:"search","aria-label":n.t("photos","Search for collaborators"),"aria-autocomplete":"list","aria-controls":"manage-collaborators__form__selection-"+n.randomId+" manage-collaborators__form__list-"+n.randomId,placeholder:n.t("photos","Search people or groups")},on:{"update:value":function(t){n.searchText=t},input:n.searchCollaborators}},[a("Magnify",{attrs:{size:16}})],1),n._v(" "),n.loadingCollaborators?a("NcLoadingIcon"):n._e()],1),n._v(" "),0!==n.searchResults.length?a("ul",{staticClass:"manage-collaborators__form__list",attrs:{id:"manage-collaborators__form__list-"+n.randomId}},n._l(n.searchResults,(function(t){return a("li",{key:t},[a("a",[a("NcListItemIcon",{staticClass:"manage-collaborators__form__list__result",attrs:{id:n.availableCollaborators[t].id,title:n.availableCollaborators[t].label,search:n.searchText,user:n.availableCollaborators[t].id,"display-name":n.availableCollaborators[t].label,"aria-label":n.t("photos","Add {collaboratorLabel} to the collaborators list",{collaboratorLabel:n.availableCollaborators[t].label})},on:{click:function(a){return n.selectEntity(t)}}})],1)])})),0):a("NcEmptyContent",{key:"emptycontent",staticClass:"manage-collaborators__form__list--empty",attrs:{title:n.t("photos","No collaborators available")}},[a("AccountGroup",{attrs:{slot:"icon"},slot:"icon"})],1)],1)],1),n._v(" "),a("ul",{staticClass:"manage-collaborators__selection"},n._l(n.listableSelectedCollaboratorsKeys,(function(t){return a("li",{key:t,staticClass:"manage-collaborators__selection__item"},[a("NcListItemIcon",{attrs:{id:n.availableCollaborators[t].id,"display-name":n.availableCollaborators[t].label,title:n.availableCollaborators[t].label,user:n.availableCollaborators[t].id}},[a("NcButton",{attrs:{type:"tertiary","aria-label":n.t("photos","Remove {collaboratorLabel} from the collaborators list",{collaboratorLabel:n.availableCollaborators[t].label})},on:{click:function(a){return n.unselectEntity(t)}}},[a("Close",{attrs:{slot:"icon",size:20},slot:"icon"})],1)],1)],1)})),0),n._v(" "),a("div",{staticClass:"actions"},[n.allowPublicLink?a("div",{staticClass:"actions__public-link"},[n.isPublicLinkSelected?[a("NcButton",{staticClass:"manage-collaborators__public-link-button",attrs:{"aria-label":n.t("photos","Copy the public link"),disabled:""===n.publicLink.id},on:{click:n.copyPublicLink},scopedSlots:n._u([{key:"icon",fn:function(){return[n.publicLinkCopied?a("Check"):a("ContentCopy")]},proxy:!0}],null,!1,845538853)},[n.publicLinkCopied?[n._v("\n\t\t\t\t\t\t"+n._s(n.t("photos","Public link copied!"))+"\n\t\t\t\t\t")]:[n._v("\n\t\t\t\t\t\t"+n._s(n.t("photos","Copy public link"))+"\n\t\t\t\t\t")]],2),n._v(" "),a("NcButton",{attrs:{type:"tertiary","aria-label":n.t("photos","Delete the public link"),disabled:""===n.publicLink.id},on:{click:n.deletePublicLink}},[""===n.publicLink.id?a("NcLoadingIcon",{attrs:{slot:"icon"},slot:"icon"}):a("Close",{attrs:{slot:"icon"},slot:"icon"})],1)]:a("NcButton",{staticClass:"manage-collaborators__public-link-button",on:{click:n.createPublicLinkForAlbum}},[a("Earth",{attrs:{slot:"icon"},slot:"icon"}),n._v("\n\t\t\t\t"+n._s(n.t("photos","Share via public link"))+"\n\t\t\t")],1)],2):n._e(),n._v(" "),a("div",{staticClass:"actions__slot"},[n._t("default",null,{collaborators:n.selectedCollaborators})],2)])])}),[],!1,null,"27acc3ac",null).exports}}]);
//# sourceMappingURL=photos-src_mixins_FetchAlbumsMixin_js-src_components_Albums_AlbumForm_vue.js.map?v=c89969030bdbab2453b0